// **********************************************************************
// Copyright (c) 2016 Baoyugame. All rights reserved.
// Author : Xianjian
// Desc	: Auto generated by MarsZ. update this if need.
// **********************************************************************

using System;
using UnityEngine;

/// <summary>
/// This is the controller class for module FindPassword, use this to control the ui or view , such as it's init , update or dispose.
/// @Xianjian
/// 实名制
/// </summary>
public class SdkOfficialController : MonoViewController<SdkOfficialView>
{
    private System.Action<bool> _callback;
    protected override void RegisterEvent()
    {
        EventDelegate.Set(_view.BackBtn.onClick, CloseView);
        EventDelegate.Set(View.CommitBtn.onClick, OnCommit);
        EventDelegate.Set(View.CancelBtn.onClick, OnCancel);

        View.CardInput.onValidate = IsValidCardNumber;

        //UICamera.onClick += ClickEventHandler;
    }

    private char IsValidCardNumber(string text, int charIndex, char addedChar)
    {
        if (addedChar == 'x' || ('0' <= addedChar && addedChar <= '9'))
        {
            return addedChar;
        }
        return (char)0;
    }

    public void SetCallback(System.Action<bool> callback)
    {
        _callback = callback;
    }

    public void OnCancel()
    {
        CloseView();

        if (_callback != null)
        {
            _callback(false);
        }
    }

    public void OnCommit()
    {
        SdkAccountModel.Instance.OnRequestRealAuth(View.NameInput.value, View.CardInput.value,
            (success) =>
            {
                if (!success)
                    return;

                if (!BaseView.IsViewDestroy(View))
                {
                    CloseView();
                }

                if (_callback != null)
                {
                    _callback(success);
                }
            });
    }

    public void CloseView()
    {
        SdkProxyModule.CloseModuleSlow(SdkOfficialView.NAME);
    }

    void ClickEventHandler(GameObject clickGo)
    {
        UIPanel panel = UIPanel.Find(clickGo.transform);
        if (panel != View.SdkOfficialView_UIPanel)
        {
            CloseView();

            if (_callback != null)
            {
                _callback(false);
            }
        }
    }

    protected override void OnDispose()
    {
        //UICamera.onClick -= ClickEventHandler;
    }
}
